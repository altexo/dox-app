!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("preact"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","preact","prop-types"],t):t(e.ReactFirestore={},e.preact,e.PropTypes)}(this,function(e,t,r){"use strict";"default"in t&&t.default;r=r&&r.hasOwnProperty("default")?r.default:r;var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},f=function(e){function t(){return n(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),o(t,[{key:"render",value:function(){var e=this.context.firestoreDatabase;return(0,this.props.render)({firestore:e})}}]),t}(t.Component);f.contextTypes={firestoreDatabase:r.object.isRequired};var l=function e(){n(this,e)},y=function(e){function t(e){n(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=e.firebase;return r.state={firestoreDatabase:o.firestore(),firestoreCache:new l},r}return s(t,e),o(t,[{key:"getChildContext",value:function(){var e=this.state;return{firestoreDatabase:e.firestoreDatabase,firestoreCache:e.firestoreCache}}},{key:"render",value:function(){return this.props.children}}]),t}(t.Component);y.childContextTypes={firestoreDatabase:r.object.isRequired,firestoreCache:r.object.isRequired};var d=function(e){function t(){var e,r,o;n(this,t);for(var s=arguments.length,f=Array(s),l=0;l<s;l++)f[l]=arguments[l];return r=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(f))),o.state={isLoading:!0,data:[],snapshot:null},o.setupFirestoreListener=function(e){var t=o.context.firestoreDatabase,r=e.path,n=a(e,["path"]),s=t.collection(r),u=o.buildQuery(s,n);o.unsubscribe=u.onSnapshot(function(e){e&&o.setState({isLoading:!1,data:e.docs.map(function(e){return i({id:e.id},e.data())}),snapshot:e})})},o.buildQuery=function(e,t){var r,n=t.sort,o=t.limit,i=t.filter,s=e;(n&&n.split(",").forEach(function(e){var t=e.split(":"),r=c(t,2),n=r[0],o=r[1];s=s.orderBy(n,o)}),o&&(s=s.limit(o)),i)&&(Array.isArray(i[0])?i.forEach(function(e){var t;s=(t=s).where.apply(t,p(e))}):s=(r=s).where.apply(r,p(i)));return s},u(o,r)}return s(t,e),o(t,[{key:"componentDidMount",value:function(){this.setupFirestoreListener(this.props)}},{key:"componentWillUnmount",value:function(){this.handleUnsubscribe()}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.path===this.props.path&&e.sort===this.props.sort&&e.limit===this.props.limit&&function e(t,r){if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}return t===r}(e.filter,this.props.filter)||(this.handleUnsubscribe(),this.setState({isLoading:!0},function(){return t.setupFirestoreListener(t.props)}))}},{key:"handleUnsubscribe",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.render;return r?r(this.state):"function"==typeof t?t(this.state):null}}]),t}(t.Component);d.contextTypes={firestoreDatabase:r.object.isRequired,firestoreCache:r.object.isRequired};var b=function(e){function t(){var e,r,o;n(this,t);for(var s=arguments.length,a=Array(s),c=0;c<s;c++)a[c]=arguments[c];return r=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.state={isLoading:!0,data:null,snapshot:null},o.setupFirestoreListener=function(e){var t=o.context.firestoreDatabase,r=e.path,n=t.doc(r);o.unsubscribe=n.onSnapshot(function(e){e&&o.setState({isLoading:!1,data:i({id:e.id},e.data()),snapshot:e})})},u(o,r)}return s(t,e),o(t,[{key:"componentDidMount",value:function(){this.setupFirestoreListener(this.props)}},{key:"componentWillUnmount",value:function(){this.handleUnsubscribe()}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.path!==this.props.path&&(this.handleUnsubscribe(),this.setState({isLoading:!0},function(){return t.setupFirestoreListener(t.props)}))}},{key:"handleUnsubscribe",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.render;return r?r(this.state):"function"==typeof t?t(this.state):null}}]),t}(t.Component);b.contextTypes={firestoreDatabase:r.object.isRequired,firestoreCache:r.object.isRequired};var v={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,mixins:!0,propTypes:!0,type:!0},m={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},g=Object.defineProperty,O=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,P=Object.getPrototypeOf,_=P&&P(Object);e.Firestore=f,e.FirestoreProvider=y,e.FirestoreCollection=d,e.FirestoreDocument=b,e.withFirestore=function(e){var t=function(t){var r=t.wrappedComponentRef,n=a(t,["wrappedComponentRef"]);return h(f,{render:function(t){return h(e,i({},n,t,{ref:r}))}})};return t.displayName="withFirestore("+(e.displayName||e.name)+")",t.WrappedComponent=e,function e(t,r,n){if("string"!=typeof r){if(_){var o=P(r);o&&o!==_&&e(t,o,n)}var i=O(r);j&&(i=i.concat(j(r)));for(var s=0;s<i.length;++s){var a=i[s];if(!(v[a]||m[a]||n&&n[a])){var u=w(r,a);try{g(t,a,u)}catch(e){}}}return t}return t}(t,e)},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=react-firestore.umd.min.js.map
