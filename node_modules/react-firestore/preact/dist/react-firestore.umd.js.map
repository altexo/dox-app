{"version":3,"file":"react-firestore.umd.js","sources":["../../src/Firestore.js","../../src/FirestoreCache.js","../../src/FirestoreProvider.js","../../src/utils/deepEqual.js","../../src/FirestoreCollection.js","../../src/FirestoreDocument.js","../../node_modules/hoist-non-react-statics/index.js","../../src/withFirestore.js"],"sourcesContent":["import { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nclass Firestore extends Component {\n  static propTypes = {\n    render: PropTypes.func.isRequired,\n  };\n\n  static contextTypes = {\n    firestoreDatabase: PropTypes.object.isRequired,\n  };\n\n  render() {\n    const { firestoreDatabase } = this.context;\n    const { render } = this.props;\n\n    return render({ firestore: firestoreDatabase });\n  }\n}\n\nexport default Firestore;\n","export default class FirestoreCache {}\n","import { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport FirestoreCache from './FirestoreCache';\n\nexport default class FirestoreProvider extends Component {\n  static propTypes = {\n    firebase: PropTypes.object.isRequired,\n    children: PropTypes.node.isRequired,\n  };\n\n  static childContextTypes = {\n    firestoreDatabase: PropTypes.object.isRequired,\n    firestoreCache: PropTypes.object.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n\n    const { firebase } = props;\n\n    this.state = {\n      firestoreDatabase: firebase.firestore(),\n      firestoreCache: new FirestoreCache(),\n    };\n  }\n\n  getChildContext() {\n    const { firestoreDatabase, firestoreCache } = this.state;\n\n    return { firestoreDatabase, firestoreCache };\n  }\n\n  render() {\n    return this.props.children;\n  }\n}\n","/**\n * Deep equality comparison for Arrays\n * @param {Array} a The array to compare against\n * @param {Array} b The array to compare with\n * @returns {boolean} If the two arrays are equal\n */\nexport default function deepEqual(a, b) {\n  if (Array.isArray(a) && Array.isArray(b)) {\n    if (a.length !== b.length) {\n      return false;\n    }\n\n    for (let i = 0; i < a.length; i++) {\n      if (!deepEqual(a[i], b[i])) {\n        return false;\n      }\n    }\n\n    return true;\n  } else {\n    return a === b;\n  }\n}\n","import { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport deepEqual from './utils/deepEqual';\n\nclass FirestoreCollection extends Component {\n  static propTypes = {\n    path: PropTypes.string.isRequired,\n    sort: PropTypes.string,\n    limit: PropTypes.number,\n    filter: PropTypes.oneOfType([\n      PropTypes.arrayOf(\n        PropTypes.oneOfType([\n          PropTypes.string,\n          PropTypes.number,\n          PropTypes.object,\n        ]),\n      ),\n      PropTypes.arrayOf(PropTypes.array),\n    ]),\n    children: PropTypes.func,\n    render: PropTypes.func,\n  };\n\n  static contextTypes = {\n    firestoreDatabase: PropTypes.object.isRequired,\n    firestoreCache: PropTypes.object.isRequired,\n  };\n\n  state = {\n    isLoading: true,\n    data: [],\n    snapshot: null,\n  };\n\n  componentDidMount() {\n    this.setupFirestoreListener(this.props);\n  }\n\n  componentWillUnmount() {\n    this.handleUnsubscribe();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (\n      nextProps.path !== this.props.path ||\n      nextProps.sort !== this.props.sort ||\n      nextProps.limit !== this.props.limit ||\n      !deepEqual(nextProps.filter, this.props.filter)\n    ) {\n      this.handleUnsubscribe();\n\n      this.setState({ isLoading: true }, () =>\n        this.setupFirestoreListener(this.props),\n      );\n    }\n  }\n\n  handleUnsubscribe() {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n    }\n  }\n\n  setupFirestoreListener = props => {\n    const { firestoreDatabase } = this.context;\n    const { path, ...queryProps } = props;\n    const collectionRef = firestoreDatabase.collection(path);\n    const query = this.buildQuery(collectionRef, queryProps);\n\n    this.unsubscribe = query.onSnapshot(snapshot => {\n      if (snapshot) {\n        this.setState({\n          isLoading: false,\n          data: snapshot.docs.map(doc => ({\n            id: doc.id,\n            ...doc.data(),\n          })),\n          snapshot,\n        });\n      }\n    });\n  };\n\n  buildQuery = (collectionRef, queryProps) => {\n    const { sort, limit, filter } = queryProps;\n    let query = collectionRef;\n\n    if (sort) {\n      sort.split(',').forEach(sortItem => {\n        const [field, order] = sortItem.split(':');\n\n        query = query.orderBy(field, order);\n      });\n    }\n\n    if (limit) {\n      query = query.limit(limit);\n    }\n\n    if (filter) {\n      //if filter is array of array, build the compound query\n      if (Array.isArray(filter[0])) {\n        filter.forEach(clause => {\n          query = query.where(...clause);\n        });\n      } else {\n        //build the simple query\n        query = query.where(...filter);\n      }\n    }\n\n    return query;\n  };\n\n  render() {\n    const { children, render } = this.props;\n\n    if (render) return render(this.state);\n\n    if (typeof children === 'function') return children(this.state);\n\n    return null;\n  }\n}\n\nexport default FirestoreCollection;\n","import { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nclass FirestoreDocument extends Component {\n  static propTypes = {\n    path: PropTypes.string.isRequired,\n    children: PropTypes.func,\n    render: PropTypes.func,\n  };\n\n  static contextTypes = {\n    firestoreDatabase: PropTypes.object.isRequired,\n    firestoreCache: PropTypes.object.isRequired,\n  };\n\n  state = {\n    isLoading: true,\n    data: null,\n    snapshot: null,\n  };\n\n  componentDidMount() {\n    this.setupFirestoreListener(this.props);\n  }\n\n  componentWillUnmount() {\n    this.handleUnsubscribe();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.path !== this.props.path) {\n      this.handleUnsubscribe();\n\n      this.setState({ isLoading: true }, () =>\n        this.setupFirestoreListener(this.props),\n      );\n    }\n  }\n\n  handleUnsubscribe() {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n    }\n  }\n\n  setupFirestoreListener = props => {\n    const { firestoreDatabase } = this.context;\n    const { path } = props;\n    const documentRef = firestoreDatabase.doc(path);\n\n    this.unsubscribe = documentRef.onSnapshot(snapshot => {\n      if (snapshot) {\n        this.setState({\n          isLoading: false,\n          data: {\n            id: snapshot.id,\n            ...snapshot.data(),\n          },\n          snapshot,\n        });\n      }\n    });\n  };\n\n  render() {\n    const { children, render } = this.props;\n\n    if (render) return render(this.state);\n\n    if (typeof children === 'function') return children(this.state);\n\n    return null;\n  }\n}\n\nexport default FirestoreDocument;\n","/**\n * Copyright 2015, Yahoo! Inc.\n * Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.\n */\n'use strict';\n\nvar REACT_STATICS = {\n    childContextTypes: true,\n    contextTypes: true,\n    defaultProps: true,\n    displayName: true,\n    getDefaultProps: true,\n    mixins: true,\n    propTypes: true,\n    type: true\n};\n\nvar KNOWN_STATICS = {\n  name: true,\n  length: true,\n  prototype: true,\n  caller: true,\n  callee: true,\n  arguments: true,\n  arity: true\n};\n\nvar defineProperty = Object.defineProperty;\nvar getOwnPropertyNames = Object.getOwnPropertyNames;\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nvar getPrototypeOf = Object.getPrototypeOf;\nvar objectPrototype = getPrototypeOf && getPrototypeOf(Object);\n\nmodule.exports = function hoistNonReactStatics(targetComponent, sourceComponent, blacklist) {\n    if (typeof sourceComponent !== 'string') { // don't hoist over string (html) components\n\n        if (objectPrototype) {\n            var inheritedComponent = getPrototypeOf(sourceComponent);\n            if (inheritedComponent && inheritedComponent !== objectPrototype) {\n                hoistNonReactStatics(targetComponent, inheritedComponent, blacklist);\n            }\n        }\n\n        var keys = getOwnPropertyNames(sourceComponent);\n\n        if (getOwnPropertySymbols) {\n            keys = keys.concat(getOwnPropertySymbols(sourceComponent));\n        }\n\n        for (var i = 0; i < keys.length; ++i) {\n            var key = keys[i];\n            if (!REACT_STATICS[key] && !KNOWN_STATICS[key] && (!blacklist || !blacklist[key])) {\n                var descriptor = getOwnPropertyDescriptor(sourceComponent, key);\n                try { // Avoid failures from read-only properties\n                    defineProperty(targetComponent, key, descriptor);\n                } catch (e) {}\n            }\n        }\n\n        return targetComponent;\n    }\n\n    return targetComponent;\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport hoistStatics from 'hoist-non-react-statics';\nimport Firestore from './Firestore';\n\nconst withFirestore = Component => {\n  const C = props => {\n    const { wrappedComponentRef, ...remainingProps } = props;\n    return (\n      <Firestore\n        render={firestoreComponentProps => (\n          <Component\n            {...remainingProps}\n            {...firestoreComponentProps}\n            ref={wrappedComponentRef}\n          />\n        )}\n      />\n    );\n  };\n\n  C.displayName = `withFirestore(${Component.displayName || Component.name})`;\n  C.WrappedComponent = Component;\n  C.propTypes = {\n    wrappedComponentRef: PropTypes.func,\n  };\n\n  return hoistStatics(C, Component);\n};\n\nexport default withFirestore;\n"],"names":["Firestore","firestoreDatabase","context","render","props","firestore","Component","contextTypes","PropTypes","object","isRequired","FirestoreCache","FirestoreProvider","firebase","state","firestoreCache","children","childContextTypes","deepEqual","a","b","Array","isArray","length","i","FirestoreCollection","setupFirestoreListener","path","queryProps","collectionRef","collection","query","buildQuery","unsubscribe","onSnapshot","snapshot","setState","docs","map","doc","id","data","sort","limit","filter","split","forEach","sortItem","field","order","orderBy","where","clause","handleUnsubscribe","nextProps","isLoading","FirestoreDocument","documentRef","defineProperty","withFirestore","C","wrappedComponentRef","remainingProps","firestoreComponentProps","displayName","name","WrappedComponent","hoistStatics"],"mappings":"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"}