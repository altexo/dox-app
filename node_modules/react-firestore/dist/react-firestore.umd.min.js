!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],t):t(e.ReactFirestore={},e.React,e.PropTypes)}(this,function(e,t,r){"use strict";var n="default"in t?t.default:t;r=r&&r.hasOwnProperty("default")?r.default:r;var o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},u=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},p=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},l=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),i(t,[{key:"render",value:function(){var e=this.context.firestoreDatabase;return(0,this.props.render)({firestore:e})}}]),t}(t.Component);l.propTypes={render:r.func.isRequired},l.contextTypes={firestoreDatabase:r.object.isRequired};var h=function e(){o(this,e)},y=function(e){function t(e){o(this,t);var r=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=e.firebase;return r.state={firestoreDatabase:n.firestore(),firestoreCache:new h},r}return a(t,e),i(t,[{key:"getChildContext",value:function(){var e=this.state;return{firestoreDatabase:e.firestoreDatabase,firestoreCache:e.firestoreCache}}},{key:"render",value:function(){return this.props.children}}]),t}(t.Component);y.propTypes={firebase:r.object.isRequired,children:r.node.isRequired},y.childContextTypes={firestoreDatabase:r.object.isRequired,firestoreCache:r.object.isRequired};var d=function(e){function t(){var e,r,n;o(this,t);for(var i=arguments.length,a=Array(i),l=0;l<i;l++)a[l]=arguments[l];return r=n=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n.state={isLoading:!0,data:[],snapshot:null},n.setupFirestoreListener=function(e){var t=n.context.firestoreDatabase,r=e.path,o=u(e,["path"]),i=t.collection(r),a=n.buildQuery(i,o);n.unsubscribe=a.onSnapshot(function(e){e&&n.setState({isLoading:!1,data:e.docs.map(function(e){return s({id:e.id},e.data())}),snapshot:e})})},n.buildQuery=function(e,t){var r,n=t.sort,o=t.limit,i=t.filter,s=e;(n&&n.split(",").forEach(function(e){var t=e.split(":"),r=p(t,2),n=r[0],o=r[1];s=s.orderBy(n,o)}),o&&(s=s.limit(o)),i)&&(Array.isArray(i[0])?i.forEach(function(e){var t;s=(t=s).where.apply(t,f(e))}):s=(r=s).where.apply(r,f(i)));return s},c(n,r)}return a(t,e),i(t,[{key:"componentDidMount",value:function(){this.setupFirestoreListener(this.props)}},{key:"componentWillUnmount",value:function(){this.handleUnsubscribe()}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.path===this.props.path&&e.sort===this.props.sort&&e.limit===this.props.limit&&function e(t,r){if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}return t===r}(e.filter,this.props.filter)||(this.handleUnsubscribe(),this.setState({isLoading:!0},function(){return t.setupFirestoreListener(t.props)}))}},{key:"handleUnsubscribe",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.render;return r?r(this.state):"function"==typeof t?t(this.state):null}}]),t}(t.Component);d.propTypes={path:r.string.isRequired,sort:r.string,limit:r.number,filter:r.oneOfType([r.arrayOf(r.oneOfType([r.string,r.number,r.object])),r.arrayOf(r.array)]),children:r.func,render:r.func},d.contextTypes={firestoreDatabase:r.object.isRequired,firestoreCache:r.object.isRequired};var b=function(e){function t(){var e,r,n;o(this,t);for(var i=arguments.length,a=Array(i),u=0;u<i;u++)a[u]=arguments[u];return r=n=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n.state={isLoading:!0,data:null,snapshot:null},n.setupFirestoreListener=function(e){var t=n.context.firestoreDatabase,r=e.path,o=t.doc(r);n.unsubscribe=o.onSnapshot(function(e){e&&n.setState({isLoading:!1,data:s({id:e.id},e.data()),snapshot:e})})},c(n,r)}return a(t,e),i(t,[{key:"componentDidMount",value:function(){this.setupFirestoreListener(this.props)}},{key:"componentWillUnmount",value:function(){this.handleUnsubscribe()}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.path!==this.props.path&&(this.handleUnsubscribe(),this.setState({isLoading:!0},function(){return t.setupFirestoreListener(t.props)}))}},{key:"handleUnsubscribe",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.render;return r?r(this.state):"function"==typeof t?t(this.state):null}}]),t}(t.Component);b.propTypes={path:r.string.isRequired,children:r.func,render:r.func},b.contextTypes={firestoreDatabase:r.object.isRequired,firestoreCache:r.object.isRequired};var v={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,mixins:!0,propTypes:!0,type:!0},m={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},g=Object.defineProperty,O=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,P=Object.getPrototypeOf,_=P&&P(Object);e.Firestore=l,e.FirestoreProvider=y,e.FirestoreCollection=d,e.FirestoreDocument=b,e.withFirestore=function(e){var t=function(t){var r=t.wrappedComponentRef,o=u(t,["wrappedComponentRef"]);return n.createElement(l,{render:function(t){return n.createElement(e,s({},o,t,{ref:r}))}})};return t.displayName="withFirestore("+(e.displayName||e.name)+")",t.WrappedComponent=e,t.propTypes={wrappedComponentRef:r.func},function e(t,r,n){if("string"!=typeof r){if(_){var o=P(r);o&&o!==_&&e(t,o,n)}var i=O(r);j&&(i=i.concat(j(r)));for(var s=0;s<i.length;++s){var a=i[s];if(!(v[a]||m[a]||n&&n[a])){var u=w(r,a);try{g(t,a,u)}catch(e){}}}return t}return t}(t,e)},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=react-firestore.umd.min.js.map
